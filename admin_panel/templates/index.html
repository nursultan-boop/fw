{% extends 'layout.html' %}

{% block content %}
<h2>Devices</h2>
<ul>
    {% for device in devices %}
    <li>
        <strong>{{ device.name }}</strong> ({{ device.ip }})
        <a href="{{ url_for('monitor_device', device_ip=device.ip) }}">Monitor</a>
        <form action="{{ url_for('remove_device', group_name='default', device_ip=device.ip) }}" method="post" style="display:inline;">
            <button type="submit">Remove</button>
        </form>
    </li>
    {% endfor %}
</ul>

<h2>Groups</h2>
<ul>
    {% for group_name, group in groups.items() %}
    <li>
        <a href="{{ url_for('group_page', group_name=group_name) }}">{{ group_name }}</a>
        <form action="{{ url_for('remove_group', group_name=group_name) }}" method="post" style="display:inline;">
            <button type="submit">Remove Group</button>
        </form>
    </li>
    {% endfor %}
</ul>
<button onclick="location.href='{{ url_for('add_group') }}'">Add New Group</button>

<h2 id="modules">Modules</h2>
<ul>
    {% for module in ['example_module'] %}
    <li>
        {{ module }}
        <button onclick="location.href='{{ url_for('module_page', module_name=module) }}'">Manage</button>
        <button onclick="toggleModule('{{ module }}')">Toggle On/Off</button>
    </li>
    {% endfor %}
</ul>

<script>
function toggleModule(module) {
    if (confirm('Are you sure you want to toggle this module?')) {
        fetch(`/toggle_module/${module}`, {method: 'POST'})
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Module toggled successfully');
                } else {
                    alert('Error toggling module');
                }
            });
    }
}
</script>
{% endblock %}
