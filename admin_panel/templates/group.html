{% extends 'layout.html' %}

{% block content %}
<h2>Group: {{ group_name }}</h2>

<h3>Rules</h3>
<ul>
    {% for rule in group.rules %}
    <li>
        {{ rule }}
        <button onclick="removeRule('{{ rule }}')">Remove</button>
        <button onclick="editRule('{{ rule }}')">Edit</button>
    </li>
    {% endfor %}
</ul>
<button onclick="addRule()">Add Rule</button>

<h3>Devices</h3>
<ul>
    {% for device in devices %}
    <li>
        <strong>Name:</strong> {{ device.name }}<br>
        <strong>IP:</strong> {{ device.ip }}<br>
        {% if device.ip in group.devices %}
        <button onclick="removeDevice('{{ device.ip }}')">Remove from Group</button>
        {% else %}
        <button onclick="addDevice('{{ device.ip }}')">Add to Group</button>
        {% endif %}
    </li>
    {% endfor %}
</ul>

<script>
function removeRule(rule) {
    if (confirm('Are you sure you want to remove this rule?')) {
        fetch(`/remove_rule/${group_name}/${rule}`, {method: 'POST'})
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Error removing rule');
                }
            });
    }
}

function editRule(rule) {
    // Implement rule editing logic here
}

function addRule() {
    // Implement rule adding logic here
}

function removeDevice(ip) {
    if (confirm('Are you sure you want to remove this device from the group?')) {
        fetch(`/remove_device/${group_name}/${ip}`, {method: 'POST'})
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Error removing device');
                }
            });
    }
}

function addDevice(ip) {
    if (confirm('Are you sure you want to add this device to the group?')) {
        fetch(`/add_device/${group_name}/${ip}`, {method: 'POST'})
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Error adding device');
                }
            });
    }
}
</script>
{% endblock %}
